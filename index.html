<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pondicherry: A Digital Reverie (Polished)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <style>
        /* --- DESIGN PHILOSOPHY & SETUP --- */
        :root {
            --bg-light: #F8F5F2;
            --text-dark: #4E4A47;
            --pastel-sand: #F3D5A5;
            --pastel-sky: #A8D8EA;
            --pastel-terracotta: #E4B4B4;
            --pastel-seafoam: #BDE0C3;
            --shadow-color: rgba(78, 74, 71, 0.1);
            --shadow-soft: 0 10px 30px var(--shadow-color);
            --shadow-lifted: 0 25px 50px -12px var(--shadow-color);
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Inter', sans-serif;
            --transition-curve: cubic-bezier(0.645, 0.045, 0.355, 1);
            --transition-duration: 0.6s; /* Slightly faster for a snappier feel */
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-light);
            color: var(--text-dark);
            overflow-x: hidden;
            transition: background-color var(--transition-duration) var(--transition-curve);
        }

        /* --- GEOMETRIC BACKGROUND PATTERN --- */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><path d="M0 0 L40 40 M40 0 L0 40" stroke="%23EAE6E3" stroke-width="0.5"/></svg>');
            opacity: 0.5;
            z-index: -2;
            transition: opacity var(--transition-duration) var(--transition-curve);
        }

        /* --- HERO SECTION --- */
        .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 2rem; position: relative; overflow: hidden; }
        .hero__background-shape { position: absolute; z-index: -1; border-radius: 50%; filter: blur(80px); animation: slow-pulse 15s infinite alternate; }
        #shape1 { width: 40vw; height: 40vw; min-width: 300px; min-height: 300px; background: linear-gradient(135deg, var(--pastel-sand), var(--pastel-sky)); top: 10%; left: 5%; }
        #shape2 { width: 35vw; height: 35vw; min-width: 250px; min-height: 250px; background: linear-gradient(135deg, var(--pastel-terracotta), var(--pastel-seafoam)); bottom: 5%; right: 10%; animation-delay: -7s; }
        @keyframes slow-pulse { from { transform: scale(0.9) rotate(0deg); } to { transform: scale(1.1) rotate(20deg); } }
        .hero__title { font-family: var(--font-serif); font-size: clamp(3rem, 12vw, 8rem); line-height: 1; letter-spacing: 0.03em; animation: fadeIn 1.5s var(--transition-curve) both; }
        .hero__subtitle { font-weight: 300; font-size: clamp(1rem, 3vw, 1.5rem); letter-spacing: 0.3em; text-transform: uppercase; margin-top: 1.5rem; opacity: 0; animation: fadeIn 1.5s 0.5s var(--transition-curve) both; }
        .scroll-indicator { position: absolute; bottom: 2rem; opacity: 0; animation: fadeIn 1.5s 1s var(--transition-curve) both, bounce 2s infinite; font-size: 1.2rem; font-weight: 300; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }

        /* --- GALLERY SECTION --- */
        .gallery-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10vh 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 4rem;
            transition: transform var(--transition-duration) var(--transition-curve), filter var(--transition-duration) var(--transition-curve);
        }
        
        .postcard {
            position: relative;
            cursor: pointer;
            aspect-ratio: 3 / 4;
            /* Will-change hints to the browser about upcoming transformations */
            will-change: transform;
            transition: transform var(--transition-duration) var(--transition-curve),
                        box-shadow var(--transition-duration) var(--transition-curve);
        }
        .postcard:hover { transform: translateY(-10px) scale(1.02); box-shadow: var(--shadow-lifted); }
        .postcard.is-opening, .postcard.is-closing { cursor: default; } /* Prevent hover effects during transition */
        .postcard__image-wrapper { width: 100%; height: 100%; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow-soft); transition: box-shadow var(--transition-duration) var(--transition-curve); }
        .postcard__image { width: 100%; height: 100%; object-fit: cover; transform: scale(1.05); transition: transform 0.7s var(--transition-curve); }
        .postcard:hover .postcard__image { transform: scale(1.1); }
        .postcard__overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 50%); border-radius: 12px; display: flex; flex-direction: column; justify-content: flex-end; padding: 1.5rem; color: white; opacity: 1; transition: opacity 0.5s var(--transition-curve); }
        .postcard__title { font-family: var(--font-serif); font-size: 1.75rem; line-height: 1.2; transform: translateY(10px); transition: transform 0.5s var(--transition-curve); }
        .postcard__tagline { font-weight: 300; font-size: 0.9rem; opacity: 0; transition: opacity 0.5s var(--transition-curve); }
        .postcard:hover .postcard__title { transform: translateY(0); }
        .postcard:hover .postcard__tagline { opacity: 1; }

        /* --- FOCUS MODE: The Immersive Experience --- */
        .focus-content {
            display: none;
            padding: 2rem;
            max-width: 600px;
        }
        .focus-content p { font-size: 1.1rem; line-height: 1.8; font-weight: 300; margin-bottom: 1.5rem; }
        
        /* FIX: Manages the initial state via CSS, not inline styles */
        .close-button {
            position: fixed;
            top: 2rem;
            right: 2rem;
            font-size: 2rem;
            background: none;
            border: none;
            color: var(--text-dark);
            cursor: pointer;
            z-index: 1002;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.5s var(--transition-curve), transform 0.5s var(--transition-curve);
            pointer-events: none; /* Inactive by default */
        }
        /* FIX: New class to control visibility */
        .close-button.is-visible {
            opacity: 0.7;
            transform: scale(1);
            transition-delay: 0.3s;
            pointer-events: auto; /* Clickable when visible */
        }
        .close-button.is-visible:hover { opacity: 1; transform: scale(1.1); }
        
        /* FIX: Dedicated overlay for click-outside-to-close */
        .click-outside-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-duration) var(--transition-curve);
        }

        /* Body states for focus mode */
        body.focus-active { overflow: hidden; }
        body.focus-active .gallery-container {
            /* FIX: The blur is now applied to individual cards, not the container */
            transform: scale(0.98);
        }
        body.focus-active .postcard:not(.is-active) {
            filter: blur(10px);
        }
        body.focus-active::before { opacity: 0.1; }
        body.focus-active .click-outside-overlay { opacity: 1; pointer-events: auto; }
        
        .postcard.is-active {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 90vw;
            max-width: 900px;
            height: 60vh;
            max-height: 600px;
            transform: translate(-50%, -50%);
            z-index: 1000;
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            cursor: default;
            background: var(--bg-light);
            box-shadow: 0 40px 100px -20px rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow: hidden;
            /* FIX: Refined transition for FLIP */
            transition: transform var(--transition-duration) var(--transition-curve),
                        width var(--transition-duration) var(--transition-curve),
                        height var(--transition-duration) var(--transition-curve),
                        top var(--transition-duration) var(--transition-curve),
                        left var(--transition-duration) var(--transition-curve),
                        box-shadow var(--transition-duration) var(--transition-curve);
        }
        
        .postcard.is-active .postcard__image-wrapper { height: 100%; border-radius: 0; box-shadow: none; }
        .postcard.is-active .postcard__image { transform: scale(1); }
        /* FIX: Synchronized overlay fade-out */
        .postcard.is-active .postcard__overlay { opacity: 0; transition: opacity 0.3s; }
        .postcard.is-active .focus-content {
            display: block;
            opacity: 0;
            transform: translateY(20px);
            /* FIX: Synchronized content fade-in */
            animation: fadeIn 0.5s 0.3s var(--transition-curve) both;
        }

        /* --- MAP STYLES --- */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto 0;
            transition: grid-template-rows 0.8s var(--transition-curve);
        }
        #map {
            grid-row: 1 / 2;
            grid-column: 1 / 2;
            height: 0;
            opacity: 0;
            transition: opacity 0.8s var(--transition-curve);
            z-index: 1;
        }
        .gallery-container {
            grid-row: 1 / 2;
            grid-column: 1 / 2;
            z-index: 2;
        }
        .main-content.map-active {
            grid-template-rows: 1fr;
        }
        .main-content.map-active #map {
            height: 100vh;
            opacity: 1;
        }
        .main-content.map-active .gallery-container {
            pointer-events: none;
            opacity: 0;
        }
        .map-view-button {
            background: rgba(255,255,255,0.2);
            border: 1px solid white;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
            margin-top: 2rem;
            backdrop-filter: blur(5px);
        }
        .map-view-button:hover {
            background: white;
            color: var(--text-dark);
            transform: translateY(-3px);
        }


        /* --- RESPONSIVE ADJUSTMENTS --- */
        @media (max-width: 768px) {
            .postcard.is-active {
                grid-template-columns: 1fr;
                grid-template-rows: 250px 1fr;
                height: 85vh; /* A bit more height for mobile */
                width: 95vw;
            }
            .focus-content {
                padding: 1.5rem;
                /* FIX: Scoped overflow-y for mobile */
                overflow-y: auto;
                -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            }
            .focus-content p { font-size: 1rem; }
        }
    </style>
</head>
<body>

    <header class="hero">
        <div class="hero__background-shape" id="shape1"></div>
        <div class="hero__background-shape" id="shape2"></div>
        <h1 class="hero__title">Echoes of the Coromandel</h1>
        <h2 class="hero__subtitle">A Photographer's Journal</h2>
        <button class="map-view-button">Map View</button>
        <div class="scroll-indicator">↓</div>
    </header>

    <div class="main-content">
        <div id="map"></div>
        <main class="gallery-container">
            <!-- Postcards remain the same as before -->
        <article class="postcard" data-bg-color="#F3D5A5" data-lat="11.9317" data-lng="79.8337">
            <div class="postcard__image-wrapper"><img src="https://images.unsplash.com/photo-1605301257473-581537d8841a?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80" alt="A sun-drenched yellow wall of a villa in the French Quarter, with a bicycle parked outside." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The White Town</h3><span class="postcard__tagline">Where Time Breathes</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The White Town</h3><p>To walk these streets is to step inside a memory. The sunlight filters through the leaves of bougainvillea, painting shifting mosaics on pastel-yellow walls. You'll find yourself tracing the elegant lines of French colonial architecture, the scent of sea salt mingling with the aroma of fresh coffee from a hidden café.</p><p>This is a place to get beautifully, hopelessly lost. Let your camera guide you through sleepy lanes, past shuttered windows holding a thousand stories, and into quiet courtyards where time doesn't just slow down—it breathes.</p></div>
        </article>
        <article class="postcard" data-bg-color="#E4B4B4" data-lat="12.0000" data-lng="79.8000">
            <div class="postcard__image-wrapper"><img src="https://images.unsplash.com/photo-1593755037922-42158882414b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80" alt="The Matrimandir, a large golden sphere, surrounded by lush green gardens in Auroville." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Auroville</h3><span class="postcard__tagline">The City of Dawn</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Auroville</h3><p>Imagine a place born from a dream of unity. That is Auroville. It’s less a town and more a living experiment in humanity. As you approach its core, you feel a palpable shift in the air—a quiet hum of intention. At its center, the Matrimandir isn't just a structure; it's a focal point of silent energy, a golden globe that seems to hold the sun itself.</p><p>You don't just visit Auroville, you experience it. It's a journey inward, a glimpse into a future built on peace.</p></div>
        </article>
        <article class="postcard" data-bg-color="#A8D8EA" data-lat="11.9331" data-lng="79.8345">
            <div class="postcard__image-wrapper"><img src="https://images.unsplash.com/photo-1622611797833-b44a8b7d9e4c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80" alt="A view of Promenade Beach at dawn, with the waves of the Bay of Bengal gently lapping the shore." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The Promenade</h3><span class="postcard__tagline">The City's Shared Horizon</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The Promenade</h3><p>This is the city's grand exhale. A wide, sweeping curve where the rhythm of the waves dictates the pace of life. In the morning, you can watch the sun cast its first golden light across the Bay of Bengal, fishermen already at work. By evening, the road is reclaimed by people—families, friends, dreamers—all drawn to the magnetic pull of the sea.</p><p>Find a spot on the weathered rocks, feel the spray on your face, and watch the sky perform its nightly spectacle of color. This is where Pondicherry comes to life.</p></div>
        </article>
        <article class="postcard" data-bg-color="#BDE0C3" data-lat="11.9348" data-lng="79.8329">
            <div class="postcard__image-wrapper"><img src="https://images.unsplash.com/photo-1609249798229-291d3615f453?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80" alt="The colorful gopuram (tower) of the Manakula Vinayagar Temple, a classic example of South Indian temple architecture." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Manakula Vinayagar</h3><span class="postcard__tagline">The Heartbeat of Faith</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Manakula Vinayagar</h3><p>Just beyond the pastel facades of the French Quarter, you'll find a different kind of beauty—a riot of color, sound, and devotion. This is the Manakula Vinayagar Temple. Feel the cool stone under your feet as you step inside, the air thick with the scent of marigolds and incense. The energy here is ancient and electric.</p><p>It's a place not just to see, but to feel—a vibrant, living testament to a faith that has pulsed through these streets for centuries. And if you're lucky, you'll meet Lakshmi, the temple elephant, whose gentle blessings are a memory you'll carry with you.</p></div>
        </article>
        <article class="postcard" data-bg-color="#F3D5A5" data-lat="11.9556" data-lng="79.8389">
            <div class="postcard__image-wrapper"><img src="https://images.unsplash.com/photo-1512343879784-a960bf40e7f2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80" alt="A serene view of Serenity Beach, with golden sands, gentle waves, and colorful fishing boats." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Serenity Beach</h3><span class="postcard__tagline">The Surfer's Canvas</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Serenity Beach</h3><p>A short, breezy drive from the city's heart brings you here, to a stretch of coast that lives up to its name. This is where the ocean calls to the adventurous. You can watch local surfers dance with the waves, their silhouettes stark against the rising sun. Or maybe, you'll be brave enough to join them.</p><p>Walk along the rustic pier, feel the weathered wood beneath your feet, and watch the kaleidoscope of colorful fishing boats bobbing in the water. It’s a perfect slice of coastal life, raw and beautiful.</p></div>
        </article>
        <article class="postcard" data-bg-color="#E4B4B4" data-lat="11.9000" data-lng="79.8167">
            <div class="postcard__image-wrapper"><img src="https://images.unsplash.com/photo-1600713052181-c580b88b1f8b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80" alt="The archaeological ruins of Arikamedu, an ancient Roman trade center, surrounded by lush greenery." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Arikamedu</h3><span class="postcard__tagline">Whispers of Rome</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Arikamedu</h3><p>Here, beneath the shade of tamarind trees, lie the quiet ruins of a forgotten story. This is Arikamedu, where ancient Rome stretched its arms to trade with India. As you wander through the foundations and weathered brick, you're walking on layers of history.</p><p>Close your eyes and you can almost hear the clink of Roman coins, the chatter of merchants from distant lands. It’s a profoundly peaceful place, where nature has begun to reclaim the past, leaving behind only the faintest, most intriguing whispers of a lost world.</p></div>
        </article>
        <article class="postcard" data-bg-color="#F3D5A5" data-lat="11.9300" data-lng="79.8339">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/2366_20190425181737.jpg" alt="The exterior of the Puducherry Museum, a beautiful colonial building with a large collection of artifacts." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The Museum</h3><span class="postcard__tagline">Stories in Stone and Bronze</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The Museum</h3><p>Step out of the sun and into the cool, quiet halls of history. Housed in a former French official's residence, this museum is a treasure chest of the region's layered past. On the ground floor, you can stand face-to-face with exquisite bronze and stone sculptures from the ancient Chola and Pallava dynasties—gods and goddesses frozen in time.</p><p>Ascend the staircase, and you're transported to the French colonial era. Each artifact, from a delicate piece of pottery to a grand portrait, holds a story. It's a place to connect the dots between all the different worlds that have called this coast home.</p></div>
        </article>
        <article class="postcard" data-bg-color="#E4B4B4" data-lat="11.9311" data-lng="79.8336">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/shutterstock_1007421508_20190902174521.jpg" alt="The stunning Greco-Roman architecture of the Notre Dame des Anges church in Puducherry." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Notre Dame des Anges</h3><span class="postcard__tagline">A Sanctuary of Light</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Notre Dame des Anges</h3><p>With its elegant Greco-Roman facade, this church is a beacon of tranquility. Step inside, and you'll be enveloped by a soft, ethereal light filtering through the stained-glass windows. The interior is a masterpiece of artistry, with intricate paintings and sculptures that draw your eyes upward.</p><p>Built by French missionaries, it stands as a testament to their enduring faith. Find a seat in one of the pews, let the silence wash over you, and admire the interplay of light and shadow. It's a moment of pure, serene beauty.</p></div>
        </article>
        <article class="postcard" data-bg-color="#A8D8EA" data-lat="11.9358" data-lng="79.8311">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/1222_20190425182103.jpg" alt="The entrance to the École Française d'Extrême-Orient, a renowned research institute for Indological studies." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The French Institute</h3><span class="postcard__tagline">A Library of Ancient Knowledge</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The French Institute</h3><p>This is where the soul of India's history is carefully preserved. More than just a library, this renowned research institute is a sanctuary for scholars and the curious alike. Within its walls, you'll find a breathtaking collection of ancient manuscripts, rare books, and priceless photographs that document the rich tapestry of Indian culture and religion.</p><p>While you may not be able to read the ancient scripts, you can feel the weight of the knowledge they contain. It's a powerful reminder of the deep intellectual and cultural exchange that has long defined Pondicherry.</p></div>
        </article>
        <article class="postcard" data-bg-color="#BDE0C3" data-lat="11.9333" data-lng="79.8314">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/1223_20190425182234.jpg" alt="The beautiful facade of Our Lady of the Immaculate Conception Cathedral, a historic landmark in Puducherry." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Immaculate Conception Cathedral</h3><span class="postcard__tagline">A Legacy in White</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Immaculate Conception Cathedral</h3><p>Standing proud for centuries, this cathedral is a landmark of faith. First built in the 18th century, its grand facade is a beautiful example of French architectural grace. As you step inside, you're greeted by a sense of soaring space and profound peace.</p><p>The light seems to dance across the ornate interiors, inviting a moment of quiet reflection. This is more than a historic building; it’s a place that has been a spiritual anchor for the city, its bells chiming through the ages.</p></div>
        </article>
        <article class="postcard" data-bg-color="#F3D5A5" data-lat="11.9289" data-lng="79.8283">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/1224_20190425182404.jpg" alt="The magnificent Gothic architecture of the Sacred Heart Basilica, with its beautiful stained glass windows." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Sacred Heart Basilica</h3><span class="postcard__tagline">A Symphony in Stained Glass</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Sacred Heart Basilica</h3><p>Prepare to be captivated by the dramatic beauty of this Gothic masterpiece. As you approach, your eyes are drawn upward along its soaring lines. But the true magic is inside. When the sunlight streams through the magnificent stained-glass windows, the entire basilica is bathed in a kaleidoscope of colors.</p><p>Each window tells a story from the life of Christ, turning the cavernous space into a breathtaking gallery of light and faith. It’s a visual symphony that will leave you in awe.</p></div>
        </article>
        <article class="postcard" data-bg-color="#E4B4B4" data-lat="11.9342" data-lng="79.8336">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/1225_20190425182534.jpg" alt="The impressive facade of Raj Nivas, the official residence of the Lieutenant Governor of Puducherry." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Raj Nivas</h3><span class="postcard__tagline">The Governor's Palace</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Raj Nivas</h3><p>This grand building, once the stately home of the French Governor, now serves as the Lieutenant Governor's residence. While its gates may be closed to the public, its elegant, classical facade is a sight to behold.</p><p>Standing before it, you can feel the weight of its history and the power it once represented. It's a key piece of Pondicherry's colonial past, a symbol of the blend of cultures that defines the city. Take a moment to admire its architecture from across the street and imagine the history that has unfolded within its walls.</p></div>
        </article>
        <article class="postcard" data-bg-color="#A8D8EA" data-lat="11.9325" data-lng="79.8333">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/1226_20190425182704.jpg" alt="A view of Bharathi Park, a lush green oasis in the heart of Puducherry, with the Aayi Mandapam in the background." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Bharathi Park</h3><span class="postcard__tagline">The City's Green Lung</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Bharathi Park</h3><p>In the heart of the city, you'll find this lush, green sanctuary. Bharathi Park is where Pondicherry comes to breathe. Dappled sunlight filters through ancient trees, and the air is cooler here, filled with the scent of damp earth and flowers.</p><p>It's the perfect place to escape the midday sun, find a shady bench, and watch the world go by. At its center stands the Aayi Mandapam, a striking Greco-Roman monument that seems to rise from the greenery like a dream.</p></div>
        </article>
        <article class="postcard" data-bg-color="#BDE0C3" data-lat="11.9317" data-lng="79.8347">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/1227_20190425182834.jpg" alt="The historic Old Lighthouse of Puducherry, a popular tourist attraction offering stunning views of the city and the sea." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The Old Lighthouse</h3><span class="postcard__tagline">The Silent Watcher</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The Old Lighthouse</h3><p>This isn't just a lighthouse; it's a silent sentinel that has watched over Pondicherry for generations. Built in the 19th century, its light once guided ships safely to shore. Today, it stands as a proud relic of a bygone maritime era.</p><p>If you climb its winding staircase, you'll be rewarded with one of the best views in the city—a sweeping panorama of the rooftops, the Promenade, and the endless expanse of the Bay of Bengal. It's a view that connects you to the city's seafaring soul.</p></div>
        </article>
        <article class="postcard" data-bg-color="#F3D5A5" data-lat="11.9322" data-lng="79.8347">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/1228_20190425183004.jpg" alt="The Gandhi Memorial, a beautiful monument dedicated to Mahatma Gandhi, located on Promenade Beach." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The Gandhi Memorial</h3><span class="postcard__tagline">An Icon of Peace</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The Gandhi Memorial</h3><p>Standing tall on the bustling Promenade, this memorial is a powerful tribute to Mahatma Gandhi, the Father of the Nation. Surrounded by towering monolithic pillars, the statue of Gandhi exudes a quiet strength and profound peace.</p><p>It's a focal point on the seafront, a place where people gather, and a constant reminder of the enduring power of his message. To stand here, with the sea breeze on your face, is to feel a deep connection to India's history and its unyielding spirit of independence.</p></div>
        </article>
        <article class="postcard" data-bg-color="#E4B4B4" data-lat="11.8795" data-lng="79.8172">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/Chunnambar_Boat_House_Main_20180209121325.jpg" alt="A view of the Chunnambar Boat House, a popular tourist attraction on the Chunnambar River." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Chunnambar River</h3><span class="postcard__tagline">The Backwater Escape</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Chunnambar River</h3><p>Just a short journey from the city, you'll find the tranquil Chunnambar River, a gateway to Pondicherry's serene backwaters. From the boat house, you can hire a simple motorboat or a quiet pedal boat and explore the lush mangrove forests that line the riverbanks.</p><p>The water is calm, the air is still, and the only sounds are the gentle lapping of the water and the call of birds. It's a perfect escape, a chance to see a different, more natural side of this beautiful region.</p></div>
        </article>
        <article class="postcard" data-bg-color="#BDE0C3" data-lat="11.9328" data-lng="79.8347">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/2369_20190425183304.jpg" alt="The French War Memorial, a tribute to the soldiers who lost their lives in the First World War, located on Goubert Avenue." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The French War Memorial</h3><span class="postcard__tagline">A Solemn Remembrance</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The French War Memorial</h3><p>Set against the backdrop of the sea on Goubert Avenue, this memorial is a simple yet poignant tribute to the soldiers from French India who lost their lives in the First World War. Each year on Bastille Day, it is beautifully illuminated, and a ceremony is held to honor their memory.</p><p>It's a place for quiet contemplation, a reminder of the deep and complex history that binds France and India. Standing here, you feel a sense of solemn respect for the sacrifices made by so many.</p></div>
        </article>
        <article class="postcard" data-bg-color="#F3D5A5" data-lat="11.9339" data-lng="79.8344">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/2370_20190425183434.jpg" alt="The statue of Joseph François Dupleix, a former French governor of Puducherry, located on Goubert Avenue." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The Dupleix Statue</h3><span class="postcard__tagline">A Colonial Legacy</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The Dupleix Statue</h3><p>At the southern end of the Promenade, you'll find this imposing statue of Joseph François Dupleix, one of the most famous French governors of Pondicherry. It's a powerful symbol of the city's colonial past, a reminder of the ambitions and conflicts that shaped this coastline.</p><p>As you stand before it, with the sea breeze rustling the nearby palms, you get a tangible sense of the history layered into this city, a story of two cultures intertwined.</p></div>
        </article>
        <article class="postcard" data-bg-color="#E4B4B4" data-lat="11.9350" data-lng="79.8322">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/2371_20190425183604.jpg" alt="The historic Ananda Ranga Pillai Mansion, a fine example of Franco-Tamil architecture." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Ananda Ranga Pillai Mansion</h3><span class="postcard__tagline">Where Cultures Converge</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Ananda Ranga Pillai Mansion</h3><p>This mansion is one of the city's true architectural treasures, a perfect blend of French and Tamil design. Built in the 18th century, it was the residence of Ananda Ranga Pillai, a key interpreter for the French government.</p><p>As you admire its unique structure, you can see the story of Pondicherry in its very bones—the graceful European arches meeting the intricately carved wooden pillars of Tamil craftsmanship. It's a stunning, physical representation of the cultural fusion that makes this city so unique.</p></div>
        </article>
        <article class="postcard" data-bg-color="#BDE0C3" data-lat="11.9261" data-lng="79.8275">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/2374_20190425183904.jpg" alt="A view of the Botanical Garden in Puducherry, a lush green paradise with a variety of plants and trees." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">The Botanical Garden</h3><span class="postcard__tagline">A Colonial Eden</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">The Botanical Garden</h3><p>Step into a world of curated wilderness at the Botanical Garden. Established in the 19th century, this garden is a living library of exotic plants and ancient trees. As you wander its shaded paths, you'll find a fossilized tree trunk, a charming toy train, and fountains that murmur in the quiet air.</p><p>It's a beautifully arranged paradise, a place where nature's wildness is given a touch of French order. It's the perfect spot to lose yourself for an afternoon.</p></div>
        </article>
        <article class="postcard" data-bg-color="#F3D5A5" data-lat="11.9431" data-lng="79.7744">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/2375_20190425184034.jpg" alt="A serene view of Ousteri Lake, a birdwatcher's paradise in Puducherry, with migratory birds in the background." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Ousteri Lake</h3><span class="postcard__tagline">The Wetlands Sanctuary</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Ousteri Lake</h3><p>Just beyond the city limits lies Ousteri Lake, a vast, shimmering expanse of water that is a haven for nature lovers. This man-made lake has become a vital wetland, attracting hundreds of species of migratory birds.</p><p>Take a boat out onto the water at sunrise or sunset, and you'll be treated to a breathtaking spectacle of wings and water. The silence, broken only by the calls of birds, is profound. It’s a crucial reminder of the wild beauty that thrives just a stone's throw from the city.</p></div>
        </article>
        <article class="postcard" data-bg-color="#A8D8EA" data-lat="11.9308" data-lng="79.8311">
            <div class="postcard__image-wrapper"><img src="https://www.holidify.com/images/cmsuploads/compressed/2377_20190425184334.jpg" alt="A glimpse inside the Jawahar Toy Museum, showcasing a collection of over 120 dolls from different parts of India." class="postcard__image"></div>
            <div class="postcard__overlay"><h3 class="postcard__title">Jawahar Toy Museum</h3><span class="postcard__tagline">A Miniature India</span></div>
            <div class="focus-content"><h3 class="postcard__title" style="margin-bottom: 1.5rem;">Jawahar Toy Museum</h3><p>This isn't your average museum. Housed in an old lighthouse building, this charming space holds a unique collection of dolls from across India. Each doll is dressed in the traditional attire of its home state, creating a vibrant, miniature tapestry of the nation's incredible diversity.</p><p>It's a whimsical and delightful place that captures the color and culture of India in a truly unique way. It will bring out the child in you, regardless of your age.</p></div>
        </article>
        </main>
    </div>
    
    <!-- FIX: A dedicated, non-intrusive overlay for handling clicks -->
    <div class="click-outside-overlay"></div>
    <!-- FIX: Removed inline style -->
    <button class="close-button">×</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const postcards = document.querySelectorAll('.postcard');
            const body = document.body;
            const closeButton = document.querySelector('.close-button');
            const clickOutsideOverlay = document.querySelector('.click-outside-overlay');
            let activePostcard = null;
            let lastScrollY = 0;

            const openPostcard = (postcard) => {
                if (activePostcard || postcard.classList.contains('is-opening')) return;
                
                lastScrollY = window.scrollY;
                activePostcard = postcard;
                
                // FIX (Step 1): Robust FLIP Animation
                // 1. Get the initial position (First)
                const initialRect = postcard.getBoundingClientRect();
                
                // Add a class to set up the final state styles
                postcard.classList.add('is-active', 'is-opening');

                // 2. Get the final position (Last)
                const finalRect = postcard.getBoundingClientRect();

                // 3. Invert: Calculate the transform needed to make the final state look like the initial state
                const invertX = initialRect.left - finalRect.left;
                const invertY = initialRect.top - finalRect.top;
                const scaleX = initialRect.width / finalRect.width;
                const scaleY = initialRect.height / finalRect.height;
                
                // Apply the inverse transform without a transition
                postcard.style.transition = 'none';
                postcard.style.transform = `translate(${invertX}px, ${invertY}px) scale(${scaleX}, ${scaleY})`;
                postcard.style.transformOrigin = 'top left';

                // 4. Play: Force a reflow and then remove the inline styles to play the transition
                requestAnimationFrame(() => {
                    postcard.style.transition = '';
                    postcard.style.transform = '';
                    postcard.style.transformOrigin = '';
                });

                body.classList.add('focus-active');
                body.style.backgroundColor = postcard.dataset.bgColor || 'var(--bg-light)';
                
                // FIX (Step 5): Use class for visibility
                closeButton.classList.add('is-visible');

                // Clean up transition class
                postcard.addEventListener('transitionend', () => {
                    postcard.classList.remove('is-opening');
                }, { once: true });
            };

            const closePostcard = () => {
                if (!activePostcard || activePostcard.classList.contains('is-closing')) return;
                
                // Store the grid position of the card *before* removing the active class
                const placeholder = Array.from(postcards).find(p => p === activePostcard);
                const initialRect = placeholder.getBoundingClientRect();

                activePostcard.classList.add('is-closing');
                body.classList.remove('focus-active');
                body.style.backgroundColor = 'var(--bg-light)';
                closeButton.classList.remove('is-visible');

                // Animate back to the original position
                activePostcard.style.transform = `translate(${initialRect.left}px, ${initialRect.top}px) scale(${initialRect.width / activePostcard.offsetWidth}, ${initialRect.height / activePostcard.offsetHeight})`;
                activePostcard.style.transformOrigin = 'top left';

                // Listen for the end of the transition
                activePostcard.addEventListener('transitionend', function onTransitionEnd() {
                    this.removeEventListener('transitionend', onTransitionEnd);

                    this.classList.remove('is-active', 'is-closing');
                    this.style.transform = '';
                    this.style.transformOrigin = '';
                    this.style.transition = '';
                    
                    activePostcard = null;
                    
                    // FIX (Step 3): Restore scroll position instantly
                    window.scrollTo({ top: lastScrollY, behavior: 'instant' });
                });
            };

            postcards.forEach(postcard => {
                postcard.addEventListener('click', (e) => {
                    if (postcard.classList.contains('is-active')) return;
                    e.preventDefault();
                    openPostcard(postcard);
                });
            });

            closeButton.addEventListener('click', closePostcard);
            // FIX (Step 2): Implement click-outside-to-close
            clickOutsideOverlay.addEventListener('click', closePostcard);

            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && activePostcard) {
                    closePostcard();
                }
            });

            const mapViewButton = document.querySelector('.map-view-button');
            const mainContent = document.querySelector('.main-content');
            let map;

            mapViewButton.addEventListener('click', () => {
                mainContent.classList.toggle('map-active');
                if (mainContent.classList.contains('map-active')) {
                    if (!map) {
                        map = L.map('map').setView([11.9345, 79.831], 13);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                            attribution: '© OpenStreetMap'
                        }).addTo(map);
                    }
                    postcards.forEach(postcard => {
                        const lat = postcard.dataset.lat;
                        const lng = postcard.dataset.lng;
                        const title = postcard.querySelector('.postcard__title').textContent;
                        if (lat && lng) {
                            const marker = L.marker([lat, lng]).addTo(map);
                            marker.bindPopup(title);
                            marker.on('click', () => {
                                openPostcard(postcard);
                            });
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>

